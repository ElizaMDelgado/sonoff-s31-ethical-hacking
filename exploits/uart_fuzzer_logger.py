import serial
import time
import random
import string

# === CONFIGURATION ===
port = 'COM7'         # Update to match your COM port
baudrate = 115200     # Default for Tasmota devices
timeout = 1           # Timeout for reading UART response
num_tests = 10        # Number of fuzz tests
start_size = 100      # Starting string size
increment = 100       # Increase per test

# === OPEN SERIAL PORT ===
try:
    ser = serial.Serial(port, baudrate, timeout=timeout)
    print(f"[+] Connected to {port} at {baudrate} baud.\n")
except Exception as e:
    print(f"[!] Failed to connect: {e}")
    exit()

# === FUZZING LOOP ===
for i in range(num_tests):
    size = start_size + (i * increment)
    fuzz_input = ''.join(random.choices(string.ascii_letters + string.digits, k=size))
    print(f"[>] Sending fuzz string #{i+1} (Length: {size})")
    ser.write((fuzz_input + '\n').encode())

    # Give the device a moment to respond
    time.sleep(0.5)

    # === READ RESPONSE ===
    response = ser.read_all().decode(errors='replace').strip()
    if response:
        print(f"[<] Response: {response}\n")
    else:
        print("[<] No response.\n")

# === CLEANUP ===
ser.close()
print("[âœ“] Fuzzing complete. Serial port closed.")
